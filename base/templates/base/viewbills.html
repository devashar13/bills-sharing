{% load static   %}
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"
        integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l"
        crossorigin="anonymous"
    />
    <script
        src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
        crossorigin="anonymous"
    ></script>
    <link
        href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/ui-lightness/jquery-ui.css"
        rel="stylesheet"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"
        integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF"
        crossorigin="anonymous"
    ></script>
    <title>Share Bills</title>
</head>
  <body>
    <div class="container py-5">
      <label for="bill-dt">
        <input class="filter"  name="bill-dt" id="search1" type="date" />
      </label>
      <label for="ex-from-date">
        <input class="filter"  name="ex-from-date" id="search2" type="date" />
      </label>
      <label for="ex-to-date">
        <input class="filter"  name="ex-to-date" id="search3" type="date" />
      </label>
      <table id = "myTable" class="table table-responsive table-hover table-striped">
        <thead class="thead-dark">
          <tr>
            <th>Bill No</th>
            <th>Vendor</th>
            <th>Exp Id</th>
            <th>Bill Amt</th>
            <th>Invoice Date</th>
            <th>Expense From</th>
            <th>Expense To</th>
            <th>Status</th>

          </tr>
        </thead>
        <tbody id="datarow">
          {% for bill in bills %}
          <tr>
            <td class = "invoice" style="cursor: pointer;" >{{bill.invoice_num}}</td>
            <td>{{bill.vendor__name}}</td>
            <td>{{bill.expense_id}}</td>
            <td>{{bill.amount}}</td>
            <td class = "invdt">{{bill.invoice_date}}</td>
            <td class="exfrom">{{bill.exp_from_date}}</td>
            <td class="exto">{{bill.exp_to_date}}</td>
            <td class="paid">{{bill.paid}}</td>
          </tr>
          {% endfor %}

        </tbody>
        
      </table>
    </div>
    <div tabindex="-1" class="modal fade" id="myModal" role="dialog">
      <div class="modal-dialog">
      
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Modal Header</h4>
          </div>
          <div class="modal-body">
           
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>
        
      </div>
    </div>
  </body>

<script>
  $('.invdt').each(function() {
    x = ($(this).html())
    inv_date = new Date(x)
    var day = inv_date.getDate();
    var month = inv_date.getMonth() + 1
    var year = inv_date.getFullYear();
    if (String(month).length < 2){
      month = '0' + month;
    }
    var today = year+'-'+month+'-'+day;
    $(this).html(today)
});
$('.exfrom').each(function(){
    x = ($(this).html())
    inv_date = new Date(x)
    var day = inv_date.getDate();
    var month = inv_date.getMonth() + 1
    var year = inv_date.getFullYear();
    if (String(month).length < 2){
      month = '0' + month;
    }
    var today = year+'-'+month+'-'+day;
    $(this).html(today) 
});
$('.exto').each(function() {
    x = ($(this).html())
    inv_date = new Date(x)
    var day = inv_date.getDate();
    var month = inv_date.getMonth() + 1
    var year = inv_date.getFullYear();
    if (String(month).length < 2){
      month = '0' + month;
    }
    var today = year+'-'+month+'-'+day;
    $(this).html(today)
});
$('.paid').each(function() {
    x = ($(this).html())
    if(x == "False"){
    $(this).html("Unpaid")
    }else{
    $(this).html("Paid")

    }
});
</script>
<script>

function performReset() {
  document.getElementById("search1").value = "";
  document.getElementById("search2").value = "";
  document.getElementById("search3").value = "";
  filterTable(event, 0);
}

function filterTable(event, index) {
  var filter = event.target.value.toUpperCase();
  var rows = document.querySelector("#mytable tbody").rows;
  for (var i = 0; i < rows.length; i++) {
    var firstCol = rows[i].cells[4].textContent.toUpperCase();
    var secondCol = rows[i].cells[5].textContent.toUpperCase();
    var thirdCol = rows[i].cells[6].textContent.toUpperCase();
    if ((firstCol.indexOf(filter) > -1 && index == 0) || (secondCol.indexOf(filter) > -1 && index == 1) || (thirdCol.indexOf(filter) > -1 && index == 2)) {
      rows[i].style.display = "";
    } else {
      rows[i].style.display = "none";
    }      
  }
}

document.querySelectorAll('input.filter').forEach(function(el,idx){
  el.addEventListener('change', function(e){
    filterTable(e, idx);
  }, false);
});
</script>
<script>
  $(document).ready( function () {
    $('#myTable').DataTable();
} );
$(".invoice").dblclick(function(){
  dataimg = $(this).html()
  console.log(dataimg)
  $.ajax({
                headers: { 'X-CSRFToken': '{{csrf_token}}' },
                type: 'POST',
                url: '/sendImages/',
                dataType: 'json',
                data: {
                    bill: dataimg,
                },
                success: function (response) {
                    console.log(dataimg)
                    console.log(response[dataimg]);
                    html = `<img src = '${response[dataimg]}'/>`
                    $('.modal-content .modal-body').append(html) 
                    $('#myModal').modal('show');
                },
                error:function(e){
                  console.log("hekansd")
                  
                }
            });
}); 
</script>

  <!-- <script>
    
    var bills = [
     {% for bill in bills %}
         {% if not forloop.first %},{% endif %}
         {
             vendor: "{{bill.vendor__name}}",
             inv_no:"{{bill.invoice_num}}",
             invoice_date:"{{bill.invoice_date}}",
             expense_id:"{{bill.expense_id}}",
             exp_from_date:"{{bill.exp_from_date}}",
             exp_to_date:"{{bill.exp_to_date}}",
             quantity:"{{bill.quantity}}",
             rate:"{{bill.rate}}",
             amount:"{{bill.amount}}",
             gst:"{{bill.gst}}",
             other:"{{bill.other}}",
             total_amount:"{{bill.total_amount}}",
             due_payment:"{{bill.due_payment}}",
             paid:"{{bill.paid}}",
           }
     {% endfor %}
     ]
       for(i = 0;i<bills.length;i++){

       $(`#datarow`).append(`
       <tr>
         <td>${bills[i].inv_no}</td>
         <td>${bills[i].vendor}</td>
         <td>${bills[i].expense_id}</td>
         <td>${bills[i].amount}</td>
         <td>${bills[i].invoice_date}</td>
         <td>${bills[i].exp_from_date}</td>
         <td>${bills[i].exp_to_date}</td>
        
       </tr>`)
     }
     let unpaid = false;
     $("#unpaid").click(function(){
       unpaid = true
       $("#datarow").html("")
       for(i = 0;i<bills.length;i++){
       if(bills[i].paid == "False"){
       $(`#datarow`).append(`
       <tr>
         <td>${bills[i].inv_no}</td>
         <td>${bills[i].vendor}</td>
         <td>${bills[i].expense_id}</td>
         <td>${bills[i].amount}</td>
       </tr>`)
       }
     }
     

     })
     $("#all").click(function(){
       $("#datarow").html("")
       for(i = 0;i<bills.length;i++){
       $(`#datarow`).append(`
       <tr>
         <td>${bills[i].inv_no}</td>
         <td>${bills[i].vendor}</td>
         <td>${bills[i].expense_id}</td>
         <td>${bills[i].amount}</td>
       </tr>`)
     }

     })
     $("#bill-dt").datepicker({
         dateFormat: 'yy-mm-dd',
         changeMonth: true,
         numberOfMonths: 1,
         onClose: function (selectedDate) {
           $("#datarow").html("")
       for(i = 0;i<bills.length;i++){

        inv_date = new Date(bills[i].invoice_date)
        var day = inv_date.getDate();
        var month = inv_date.getMonth() + 1
        var year = inv_date.getFullYear();
        
      if (String(month).length < 2){
        month = '0' + month;
      }
    if (String(day).length < 2){
      day = '0' + day;
    }
        var today = year+'-'+month+'-'+day;
         if(String(today) == selectedDate){
           $(`#datarow`).append(`
       <tr>
         <td>${bills[i].inv_no}</td>
         <td>${bills[i].vendor}</td>
         <td>${bills[i].expense_id}</td>
         <td>${bills[i].amount}</td>
       </tr>`)
         }

     }
         }
     });
     $("#ex-from-date").datepicker({
       
        dateFormat: 'yy-mm-dd',
        changeMonth: true,
        numberOfMonths: 1,
        onClose: function (selectedDate) {
          $("#datarow").html("")
            $("#ex-to-date").datepicker("option", "minDate", selectedDate);
            for(i = 0;i<bills.length;i++){

                inv_date = new Date(bills[i].exp_to_date)
                var day = inv_date.getDate();
                var month = inv_date.getMonth() + 1
                var year = inv_date.getFullYear();

                if (String(month).length < 2){
                month = '0' + month;
                }
                if (String(day).length < 2){
                day = '0' + day;
                }
                var today = year+'-'+month+'-'+day;
                if(String(today) == selectedDate){
                  $(`#datarow`).append(`
                <tr>
                <td>${bills[i].inv_no}</td>
                <td>${bills[i].vendor}</td>
                <td>${bills[i].expense_id}</td>
                <td>${bills[i].amount}</td>
                </tr>`)
                }

          }
        }
    });
    $("#ex-to-date").datepicker({
        dateFormat: 'yy-mm-dd',
        changeMonth: true,
        numberOfMonths: 1,
        onClose: function (selectedDate) {
          $("#datarow").html("")

            $("#ex-from-date").datepicker("option", "maxDate", selectedDate);
            for(i = 0;i<bills.length;i++){

              inv_date = new Date(bills[i].exp_from_date)
              to_date = new Date(bills[i].exp_to_date)
              var day = inv_date.getDate();
              var month = inv_date.getMonth() + 1
              var year = inv_date.getFullYear();
              var today = to_date.getDate();
              var tomonth = to_date.getMonth() + 1
              var toyear = to_date.getFullYear();

              if (String(tomonth).length < 2){
              month = '0' + month;
              }
              if (String(today).length < 2){
              day = '0' + day;
              }
              var today = year+'-'+month+'-'+day;
              var to = toyear+'-'+tomonth+'-'+today;
              console.log(String(today),$("#ex-from-date").val())
              console.log(String(to),selectedDate)
              if(String(today) == $("#ex-from-date").val() && String(to) === selectedDate){
                $(`#datarow`).append(`
              <tr>
              <td>${bills[i].inv_no}</td>
              <td>${bills[i].vendor}</td>
              <td>${bills[i].expense_id}</td>
              <td>${bills[i].amount}</td>
              </tr>`)
              }

}
        }
    }); -->
  </script>
</html>
